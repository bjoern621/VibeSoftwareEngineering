meta {
  name: 02 - Get My Bookings
  type: http
  seq: 2
}

get {
  url: {{baseUrl}}/api/kunden/meine-buchungen
  body: none
  auth: bearer
}

auth:bearer {
  token: {{authToken}}
}

script:pre-request {
  const axios = require('axios');
  const baseUrl = bru.getEnvVar("baseUrl");
  const token = bru.getEnvVar("authToken");
  
  if (!token || token === "") {
    try {
      const loginRes = await axios.post(`${baseUrl}/api/kunden/login`, {
        email: "bruno.test@example.com",
        password: "SecurePass123!"
      });
      if (loginRes.data && loginRes.data.token) {
        bru.setEnvVar("authToken", loginRes.data.token);
      }
    } catch (e) {
      console.log("Auto-login failed:", e.message);
    }
  }
}

tests {
  test("Status is 200 OK", function() {
    expect(res.status).to.equal(200);
  });

  test("Response is an array", function() {
    expect(res.body).to.be.an("array");
  });
}
