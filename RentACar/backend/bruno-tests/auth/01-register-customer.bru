meta {
  name: 01 - Register Customer
  type: http
  seq: 1
}

post {
  url: {{baseUrl}}/api/kunden/registrierung
  body: json
  auth: none
}

body:json {
  {
    "email": "test.customer@example.com",
    "password": "Test1234!",
    "firstName": "Bruno",
    "lastName": "Testuser",
    "phoneNumber": "+49 30 12345678",
    "street": "Teststra√üe 123",
    "postalCode": "10115",
    "city": "Berlin",
    "driverLicenseNumber": "B1234567890"
  }
}

tests {
  test("Status is 201 Created or 400/409 if user exists", function() {
    expect([201, 400, 409]).to.include(res.status);
  });

  test("Response contains token if created", function() {
    if (res.status === 201) {
      expect(res.body.token).to.be.a("string");
      expect(res.body.token.length).to.be.greaterThan(0);
    }
  });

  test("Response contains customer data if created", function() {
    if (res.status === 201) {
      expect(res.body.email).to.equal("test.customer@example.com");
    }
  });
}

script:post-response {
  if (res.status === 201 && res.body.token) {
    bru.setEnvVar("authToken", res.body.token);
    bru.setEnvVar("customerId", res.body.customerId);
  }
}
