meta {
  name: 01 - Get Profile
  type: http
  seq: 1
}

get {
  url: {{baseUrl}}/api/kunden/profil
  body: none
  auth: bearer
}

auth:bearer {
  token: {{authToken}}
}

script:pre-request {
  const axios = require('axios');
  const baseUrl = bru.getEnvVar("baseUrl");
  const token = bru.getEnvVar("authToken");
  
  if (!token || token === "") {
    try {
      const loginRes = await axios.post(`${baseUrl}/api/kunden/login`, {
        email: "test.customer@example.com",
        password: "Test1234!"
      });
      if (loginRes.data && loginRes.data.token) {
        bru.setEnvVar("authToken", loginRes.data.token);
      }
    } catch (e) {
      console.log("Auto-login failed:", e.message);
    }
  }
}

tests {
  test("Status is 200 OK", function() {
    expect(res.status).to.equal(200);
  });

  test("Response contains customer data", function() {
    expect(res.body.email).to.equal("test.customer@example.com");
    expect(res.body.firstName).to.be.a("string");
    expect(res.body.lastName).to.be.a("string");
  });

  test("Response contains address", function() {
    expect(res.body.street).to.be.a("string");
    expect(res.body.city).to.equal("Berlin");
  });
}
